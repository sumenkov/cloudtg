# Проблема: устаревшее состояние окна слушателя в FileManager

## Проблема
`FileManager` обновляет ссылки на слушатели (`selectedNodeRef`, `isRootSelectedRef`, `reloadFilesRef`) внутри `useEffect`.

Поскольку `useEffect` выполняется после отрисовки, после рендеринга остается небольшой интервал, в течение которого долгоживущие слушатели (`tree_updated`, перетаскивание `drop`) могут считывать значения из предыдущего рендеринга. На практике это может привести к пропуску обновлений или применению загрузок к устаревшему выбору папки, когда внешние события срабатывают сразу после изменения состояния.


## Исправление
Присваивание последних значений ссылкам непосредственно во время рендеринга:
- `selectedNodeRef.current = selectedNode`
- `isRootSelectedRef.current = isRootSelected`
- `reloadFilesRef.current = reloadFiles`

Это обеспечивает синхронизацию чтения слушателей с текущим рендерингом, сохраняя при этом стабильные подписки.

## Проверка
- `npm test`
- `npm --workspace ui run build`